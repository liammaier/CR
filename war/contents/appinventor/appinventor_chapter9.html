<!DOCTYPE html>
<html lang="en-US">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />


	<head>
		<title> App Inventor Chapter 9 </title>
	</head>

  <body>
	<div id="appinventor9" class="appinventor container"> 
		<div class="page">

<!-- Page 131 -->

			<div class="chapter_head">
				CHAPTER 9
			</div>

			<section class="section" data-number="0" data-name="Xylophone">

				<h2>Xylophone</h2>

				<img class="leftImage" src="/contents/appinventor/images/ch09img01.png">

				<div class="chapter_description">
					<p>It’s hard to believe that using technology to record 
						and play back music only dates back to 1878, when 
						Edison patented the phonograph. We’ve come so far 
						since then—with music synthesizers, CDs, sampling 
						and remixing, phones that play music, and even 
						long-distance jamming over the Internet. In this 
						chapter, you’ll take part in this tradition by building 
						a Xylophone app that records and plays music.</p>
				</div>

			</section> <!-- Section 0, Xylophone -->

			<section class="section" data-number="1" data-name="What You'll Build">

				<div class="clear" />

				<figure class="rightfig">
					<img src="/contents/appinventor/images/ch09img02.png">
					<figcaption>Figure 9-1. The Xylophone app UI</figcaption>
				</figure>

				<h3>What You'll Build</h3>

				<p>With the app shown in Figure 9-1 (originally created by Liz Looney of the App Inventor team), you can:</p>

				<ul>
					<li>Play eight different notes by touching colored buttons on the screen.</li>
					<li>Press a Play button to replay the notes you played earlier.</li>
					<li>Press a Reset button to make the app forget what notes you played earlier so you can enter a new song.</li>
				</ul>

				<div class="clear" />

			</section> <!-- Section 1, What You'll Build -->	

			<section class="section" data-number="2" data-name="What You'll Learn">

<!-- Page 132 -->

				<div class="pagebreak">
						<span class="pageNumber"> 132 </span> Chapter 9: Xylophone
				</div>

				<h3>What You'll Learn</h3>

				<p>This tutorial covers the following concepts:</p>

				<ul>
					<li>Using a single <span class="python">Sound</span> component to play different audio files.</li>
					<li>Using the <span class="python">Clock</span> component to measure and enforce delays between actions.</li>
					<li>Deciding when to create a procedure.</li>
					<li>Creating a procedure that calls itself.</li>
					<li>Advanced use of lists, including adding items, accessing them, and clearing the list.</li>
				</ul>

			</section> <!-- Section 2, What You'll Learn -->

			<section class="section" data-number="3" data-name="Getting Started">

				<h3>Getting Started</h3>

				<p>Connect to the App Inventor website and start a new project. Name it “Xylophone”, 
					and also set the screen’s title to “Xylophone”. Open the Blocks Editor and connect to 
					your phone or emulator.</p>

			</section> <!-- Section 3, Getting Started -->

			<section class="section" data-number="4" data-name="Designing the Components">

				<h3>Designing the Components</h3>

				<p>This app has 13 different components (8 of which compose the keyboard), listed in 
					Table 9-1. Since there are so many, it would get pretty boring to create all of them 
					before starting to write our program, so we’ll break down the app into its functional 
					parts and build them sequentially by going back and forth between the Designer 
					and the Blocks Editor, as we did with the Ladybug Chase app in Chapter 5.</p>

				<p class="caption">Table 9-1.All of the components for the Xylophone app</p>

				<table>
					<thead>
						<tr>
							<th>Component type</th>
							<th>Palette group</th>
							<th>What you'll name it</th>
							<th>Purpose</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">Button1</span></td>
							<td>Play Low C key.</td>
						</tr>							
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">Button2</span></td>
							<td>Play D key.</td>
						</tr>							
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">Button3</span></td>
							<td>Play E key.</td>
						</tr>							
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">Button4</span></td>
							<td>Play F key.</td>
						</tr>							
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">Button5</span></td>
							<td>Play G key.</td>
						</tr>							
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">Button6</span></td>
							<td>Play A key.</td>
						</tr>							
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">Button7</span></td>
							<td>Play B key.</td>
						</tr>							
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">Button8</span></td>
							<td>Play High C key.</td>
						</tr>							
						<tr>
							<td><span class="python">Sound</span></td>
							<td>Media</td>
							<td><span class="python">Sound1</span></td>
							<td>Play the notes.</td>
						</tr>							
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">PlayButton</span></td>
							<td>Play back the song.</td>
						</tr>							
						<tr>
							<td><span class="python">Button</span></td>
							<td>Basic</td>
							<td><span class="python">ResetButton</span></td>
							<td>Reset the song memory.</td>
						</tr>							
						<tr>
							<td><span class="python">Horizontal Arrangement</span></td>
							<td>Screen Arrangement </td>
							<td><span class="python">HorizontalArrangement1</span></td>
							<td>Place the Play and Reset buttons next to each other.</td>
						</tr>							
						<tr>
							<td><span class="python">Clock</span></td>
							<td>Basic</td>
							<td><span class="python">Clock1</span></td>
							<td>Keep track of delays between notes.</td>
						</tr>							
					</tbody>
				</table>

			</section> <!-- Section 4, Designing the Components -->

			<section class="section" data-number="5" data-name="Creating the Keyboard">

<!-- Page 133 -->

				<div class="pagebreak">
						<span class="pageNumber"> 133 </span> Creating the Keyboard
				</div>

				<h3>Creating the Keyboard</h3>

				<p>Our user interface will include an eight-note keyboard for a pentatonic (seven-note) 
					major scale ranging from Low C to High C. We will create this musical keyboard in 
					this section.</p>

				<section class="subsection" data-number="6" data-name="Creating the First Note Buttons">

					<h4>Creating the First Note Buttons</h4>

					<p>Start by creating the first two xylophone keys, which we will implement as buttons.</p>

					<ol>
						<li>From the Basic category, drag a <span class="python">Button</span> onto the screen. Leave its name as 
							<span class="python">Button1</span>. We want it to be a long magenta bar, like a key on a xylophone, so set 
							its properties as follows:</li>
							<ol>
								<li>Changing its <span class="python">BackgroundColor</span> property to Magenta.</li>
								<li>Changing its <span class="python">Text</span> property to “C”.</li>
								<li>Setting its <span class="python">Width</span> property to “Fill parent” so it goes all the way across the screen.</li>
								<li>Setting its <span class="python">Height</span> property to 40 pixels.</li>
							</ol>
						<li>Repeat for a second <span class="python">Button</span>, named <span class="python">Button2</span>, placing it below <span class="python">Button1</span>. Use 
							<span class="python">Width</span> and <span class="python">Height</span> property values, but set its <span class="python">BackgroundColor</span> property to Red 
							and its Textproperty to “D”.</li>
					</ol>

					<p>(Later, we will repeat step 2 for six more note buttons.)</p>
					
					<p>The view in the Component Designer should look something like Figure 9-2.</p>

					<figure>
						<div class="centeredImage">
							<img src="/contents/appinventor/images/ch09img03.png">
						</div>
						<figcaption>Figure 9-2. Placing buttons to create a keyboard</figcaption>
					</figure>

					<p>The display on your phone should look similar, although there will not be any empty space
						between the two colored buttons.</p>

				</section> <!-- Section 6, Creating the First Note Buttons -->

				<section class="subsection" data-number="7" data-name="Adding the Sound Component">

					<h4>Adding the Sound Component</h4>

					<p>We can’t have a xylophone without sounds, so create a <span class="python">Sound</span> component, leaving 
						its name as <span class="python">Sound1</span>. Change the <span class="python">MinimumInterval</span> property from its default value of 
						500 milliseconds to 0. This allows us to play the sound as often as we want, instead 
						of having to wait half a second (500 milliseconds) between plays. Don’t set its <span class="python">Source</span>
						property, which we will set in the Blocks Editor.</p>

<!-- Page 134 -->

					<div class="pagebreak">
							<span class="pageNumber"> 134 </span> Chapter 9: Xylophone
					</div>

					<p>Upload the sound files <em>1.wav</em> and <em>2.wav</em> from <span class="url">http://examples.oreilly.com/
						0636920016632/</span>. Unlike in previous chapters, where it was OK to change the names 
						of media files, it is important to use these exact names for reasons that will soon 
						become clear. You can either upload the remaining six sound files now or wait until 
						directed to later.</p>		

				</section> <!-- Section 7, Adding the Sound Component -->

				<section class="subsection" data-number="8" data-name="Connecting the Sounds to the Buttons">

					<h4>Connecting the Sounds to the Buttons</h4>

					<p>The behavior we need to program is for a sound file to play when the corresponding 
						button is clicked. Specifically, if <span class="python">Button1</span> is clicked, we’d like to play
						<em>1.wav</em>; if
						<span class="python">Button2</span>
						is clicked, we’d like to play <em>2.wav</em>; and so on. We can set this up in the Blocks Editor as 
						shown in Figure 9-3 by doing the following:</p>

					<ol>
						<li>From the My Blocks tab and Button1 drawer, drag out the <span class="pBlock">Button1.Click</span> block.</li>
						<li>From the Sound1 drawer, drag out the set <span class="pBlock">Sound1.Source</span> block, placing it in 
							the <span class="pBlock">Button1.Click</span> block.</li>
						<li>Type “text” to create a text block. (This is quicker than going to the Built-In tab 
							and then the Text drawer, although that would work too.) Set its <span class="python">text</span> value to 
							“1.wav” and place it in the <span class="pBlock">Sound1.Source</span> block.</li>
						<li>Add a <span class="pBlock">Sound1.Play</span> block.</li>
					</ol>

					<figure>
						<div class="centeredImage">
							<img src="/contents/appinventor/images/ch09img04.png">
						</div>
						<figcaption>Figure 9-3. Playing a sound when a button is clicked</figcaption>
					</figure>

					<p>We could do the same for <span class="python">Button2</span>, as shown in Figure 9-4 (just changing the text 
						value), but the code would be awfully repetitive.</p>

					<figure>
						<div class="centeredImage">
							<img src="/contents/appinventor/images/ch09img05.png">
						</div>
						<figcaption>Figure 9-4. Adding more sounds</figcaption>
					</figure>

					<p>Repeated code is a good sign that you should create a procedure, which you’ve 
						already done in Chapter 3’s MoleMash game and Chapter 5’s Ladybug Chase game. 
						Specifically, we’ll create a procedure that takes a number as an argument, sets 
						Sound1’s Source to the appropriate file, and plays the sound. This is another example 
						of <em>refactoring</em>—improving a program’s implementation without changing its behavior,</p>

<!-- Page 135 -->

					<div class="pagebreak">
							<span class="pageNumber"> 135 </span> Creating the Keyboard
					</div>

					<p>a concept introduced in the MoleMash tutorial. We can use the Text drawer’s <span class="pBlock">join</span> block 
						(an alternate version of <span class="pBlock">make text</span>) to combine the number (e.g., 1) and the text 
						“.wav” to create the proper filename (e.g., “1.wav”). Here are the steps for creating the 
						procedure we need:</p>

					<ol>
						<li>Under the Built-In tab, go to the Definition drawer and drag out the
							<span class="pBlock">to procedure</span> block.</li>
						<li>Go back to the Definition drawer and drag a <span class="pBlock">name</span> block into the “arg” socket of
							<span class="pBlock">to procedure</span>.</li>
						<li>Click the rightmost “name” and set the name to “number”.</li>
						<li>Click <span class="pBlock">procedure</span> and set the name to “PlayNote”.</li>
						<li>Drag the <span class="pBlock">Sound1.Source</span> block from <span class="pBlock">Button1.Click</span>
							into <span class="pBlock">PlayNote</span> to the right of the word “do”.
							The <span class="pBlock">Sound1.Play</span> block will move with it.</li>
						<li>Drag the <span class="pBlock">1.wav</span> block into the trash can.</li>
						<li>From the Text drawer, drag the <span class="pBlock">join</span> block into
							<span class="pBlock">Sound1.Source</span>’s socket.</li>
						<li>Type “number” and move it to the left socket of the <span class="pBlock">join</span> block
							(if it is not already there).</li>
						<li>From the Text drawer, drag the <span class="pBlock">text</span> block into the right socket of the
							<span class="pBlock">join</span> block.</li>
						<li>Change the text value to “.wav”. (Remember not to type the quotation marks.)</li>
						<li>Under the My Blocks tab, go to the My Definitions drawer and drag a <span class="pBlock">call PlayNote</span>
							block into the
							empty body of <span class="pBlock">Button1.Click</span>.</li>
						<li>Type “1” and put it in the “number” socket.</li>
					</ol>

					<p>Now, when <span class="python">Button1</span> is clicked, the procedure <span class="python">PlayNote</span>
						will be called, with its number
						argument having the value 1.
						It should set <span class="python"> SounSound1.Source</span> to “1.wav” and play 
						the sound.</p>

					<p>Create a similar <span class="pBlock">Button2.Click</span> block with a call to <span class="python">PlayNote</span>
						with an argument of 2. 
						(You can copy the existing <span class="pBlock">PlayNote</span> block and move it into the body of
						<span class="pBlock">Button2</span>.
						<span class="pBlock">Click</span>, making sure to change the argument.) Your program should look like Figure 9-5.</p>

					<figure>
						<div class="centeredImage">
							<img src="/contents/appinventor/images/ch09img06.png">
						</div>
						<figcaption>Figure 9-5. Creating a procedure to play a note</span>
					</figure>

				</section> <!-- Section 8, Connecting the Sounds to the Buttons -->

				<section class="subsection" data-number="9" data-name="Telling Android to Load the Sounds">

<!-- Page 136 -->

					<div class="pagebreak">
							<span class="pageNumber"> 136 </span> Chapter 9: Xylophone
					</div>

					<h4>Telling Anroid to Load the Sounds</h4>

					<p>If you tried out the preceding calls to <span class="python">PlayNote</span>, you may have been disappointed 
						by not hearing the sound you expected or by experiencing an unexpected delay. 
						That’s because Android needs to load sounds at runtime, which takes time, before 
						they can be played. This issue didn’t come up before, because filenames placed in a 
						<span class="python">Sound</span> component’s <span class="python">Source</span>
						property in the Designer are automatically loaded when 
						the program starts. Since we don’t set <span class="python">Sound1.Source</span> until <em>after</em> the program has 
						started, that initialization process does not take place. We have to explicitly load the 
						sounds when the program starts up, as shown in Figure 9-6.</p>

					<figure>
						<div class="centeredImage">
							<img src="/contents/appinventor/images/ch09img07.png">
						</div>
						<figcaption>Figure 9-6. Loading sounds when the app launches</figcaption>
					</figure>

					<div class="test_your_app">
								<img src="/contents/appinventor/images/test_phone.jpg">
								
								<p><span class="apptest_header">Test your app.</span>Now if you restart the app by clicking on “Connect to 
									Device...” in the Blocks Editor, the notes should play without delay. (If 
									you don’t hear anything, make sure that the media volume on your 
									phone is not set to mute.)</p>
					</div>

				</section> <!-- Section 9, Telling Android to Load the Sounds -->

				<section class="subsection" data-number="10" data-name="Implementing the Remaining Notes">

					<h4>Implementing the Remaining Notes</h4>

					<p>Now that we have the first two buttons and notes implemented and working, add 
						the remaining six notes by going back to the Designer and uploading the sound files 
						<em>3.wav</em>, <em>4.wav</em>, <em>5.wav</em>, <em>6.wav</em>, <em>7.wav</em>, and <em>8.wav</em>.
						Then create six new buttons, follow-ing the same
						steps as you did before but setting their <span class="python">Text</span> and
						<span class="python">BackgroundColor</span>
						properties as follows:</p>

					<ul>
						<li><span class="python">Button3</span> (“E”, Pink)</li>
						<li><span class="python">Button4</span> (“F”, Orange)</li>
						<li><span class="python">Button5</span> (“G”, Yellow)</li>
						<li><span class="python">Button6</span> (“A”, Green)</li>
						<li><span class="python">Button7</span> (“B”, Cyan)</li>
						<li><span class="python">Button8</span> (“C”, Blue)</li>
					</ul>

<!-- Page 137 -->

					<div class="pagebreak">
							<span class="pageNumber"> 137 </span> Creating the Keyboard
					</div>

					<p>You may also want to change <span class="python">Button8</span>’s <span class="python">TextColor</span>
						property to White, as shown in Figure 9-7, so it is more legible.</p>

					<figure>
						<div class="centeredImage">
							<img src="/contents/appinventor/images/ch09img08.png">
						</div>
						<figcaption>Figure 9-7. Putting the remaining buttons and sounds in the Component Designer</figcaption>
					<figure>

					<p>Back in the Blocks Editor, create <span class="pBlock">Click</span> blocks for each of the new buttons
						with appropriate calls to
						<span class="python">PlayNote</span>. Similarly, add each new sound file to
						<span class="pBlock">Screen.Initialize</span>, 
						as shown in Figure 9-8.</p>
					
					<p>With your program getting so large, you might find it helpful to click the white minus 
						signs near the bottom of the “container” blocks, such as <span class="pBlock">PlayNote</span>, to minimize them 
						and conserve screen space.</p>

					<div class="test_your_app">
								<img src="/contents/appinventor/images/test_phone.jpg">
								
								<p class="twoLines"><span class="apptest_header">Test your app.</span>You should now have all the buttons,
									and each one will play a different note when you click it.</p>

								<div class="clear"></div>
					</div>

<!-- Page 138 -->

					<div class="pagebreak">
							<span class="pageNumber"> 138 </span> Chapter 9: Xylophone
					</div>

					<figure>
						<div class="centeredImage">
							<img src="/contents/appinventor/images/ch09img09.png">
						</div>
						<figcaption>Figure 9-8. Programming the button click events to correspond to all the keyboard keys</figcaption>

				</section><!-- Section 10, Implementing the Remaining Notes -->

			</section> <!-- Section 5, Creating the Keyboard -->

			<section class="section" data-number="11" data-name="Recording and Playing Back Notes">

				<h3>Recording and Playing Back Notes</h3>

				<p>Playing notes by pressing buttons is fun, but being able to record and play back 
					songs is even better. To implement playback, we will need to maintain a record of 
					played notes. In addition to remembering the pitches (sound files) that were played, 
					we must also record the amount of time between notes, or we won’t be able to 
					distinguish between two notes played in quick succession and two played with a 
					10-second silence between them.

				<p>Our app will maintain two lists, each of which will have one entry for each note that 
					has been played:</p>

				<ul>
					<li><span class="python">notes</span>, which will contain the names of the sound files in the order in which
						they were played</li>
					<li><span class="python">times</span>, which will record the points in time at which the notes were played</li>
				</ul>

				<div class="note">
					<img src="/contents/appinventor/images/tip_suggestion.jpg">
					
					<p class="twoLines"><span class="pBlock normalFont">Note.</span>Before continuing, you may wish to review lists,
						which we 
						covered in the Presidents Quiz in Chapter 8.</p>
				</div>

<!-- Page 139 -->

					<div class="pagebreak">
							<span class="pageNumber"> 139 </span> Recording and Playing Back Notes
					</div>

					<p>We can get the timing information from a <span class="python">Clock</span> component, which we will also use 
						to properly time the notes for playback.</p>

					<section class="subsection" data-number="12" data-name="Adding the Components">

						<h4>Adding the Components</h4>

						<p>In the Designer, you will need to add a <span class="python">Clock</span> component and Play and
							Reset buttons, which we will put in a <span class="python">HorizontalArrangement</span>:</p>

						<ol>
							<li>Drag in a <span class="python">Clock</span> component. It will appear in the “Non-visible components”
								section. Uncheck its
								<span class="python">TimerEnabled</span> property because we don’t want its timer to go 
							off until we tell it to during playback.</li>
							<li>Go to the Screen Arrangement category and drag a <span class="python">HorizontalArrangement</span>
							component beneath the existing button. Set its <span class="python">Width</span> property to “Fill parent.”</li>
							<li>From the Basic category, drag in a <span class="python">Button</span>. Rename it
								<span class="python">PlayButton</span> and set its 
								<span class="python">Text</span> property to “Play”.</li>
							<li>Drag in another <span class="python">Button</span>, placing it to the right of
								<span class="python">PlayButton</span>. Rename the new <span class="python">Button</span> to
								<span class="python">ResetButton</span> and set its Textproperty to “Reset”.</li>
						</ol>

						<p>The Designer view should look like Figure 9-9.</p>

						<figure>
							<div class="centeredImage">
								<img src="/contents/appinventor/images/ch09img10.png">
							</div>
							<figcaption>Figure 9-9. Adding components for recording and playing back sounds</figcaption>
						</figure>

					</section><!-- Section 12, Adding the Components -->

					<section class="subsection" data-number="13" data-name="Recording Notes and Times">

<!-- Page 140 -->

						<div class="pagebreak">
								<span class="pageNumber"> 140 </span> Chapter 9: Xylophone
						</div>

						<h4>Recording Notes and Times</h4>

						<p>We now need to add the correct behavior in the Blocks Editor. We will need to main-tain lists of
							notes and times and add to the lists whenever the user presses a button.</p>

						<ol>
							<li>Create a new variable by going to the Built-In tab and dragging out a
								<span class="pBlock">def variable</span> block from the Definition drawer.</li>
							<li>Click “variable” and change it to “notes”.</li>
							<li>Open the Lists drawer and drag a <span class="pBlock">make a list</span> block out, placing it in the socket 
								of <span class="pBlock">def notes</span>.</li>
						</ol>

						<p>This defines a new variable named “notes” to be an empty list. Repeat the steps for 
							another variable, which you should name “times”. These new blocks should look like 
							Figure 9-10.</p>

						<figure>
							<div class="centeredImage">
								<img src="/contents/appinventor/images/ch09img11.png">
							</div>
							<figcaption>Figure 9-10. Setting the variables to record notes</figcaption>
						</figure>

						<section class="subsection" data-number="14" data-name="How the blocks work">

							<h5>How the blocks work</h5>

							<p>Whenever a note is played, we need to save both the name of the sound file (to the 
								list <span class="python">notes</span>) and the instant in time at which it was played (to the list
								<span class="python">times</span>). To record 
								the instant in time, we will use the <span class="pBlock">Clock1.Now</span> block, which returns the current 
								instant in time (e.g., March 12, 2011, 8:33:14 AM), to the nearest millisecond. These 
								values, obtained through the <span class="pBlock">Sound1.Source</span> and
								<span class="pBlock">Clock1.Now</span> blocks, should be 
								added to the lists notesand times, respectively, as shown in Figure 9-11.</p>

							<figure>
								<div class="centeredImage">
									<img src="/contents/appinventor/images/ch09img12.png">
								</div>
								<figcaption>Figure 9-11. Adding the sounds played to the list</figcaption>
							</figure>

<!-- Page 141 -->

							<div class="pagebreak">
									<span class="pageNumber"> 141 </span> Recording and Playing Back Notes
							</div>

							<p>For example, if you play “Row, Row, Row Your Boat” [C C C D E], your lists would end 
								up having five entries, which might be:</p>

							<ul>
								<li><span class="python">notes</span>: <em>1.wav</em>, <em>1.wav</em>, <em>1.wav</em>, <em>2.wav</em>,
									<em>3.wav</em></li>
								<li><span class="python">times</span> [dates omitted]: 12:00:01, 12:00:02, 12:00:03, 12:00:03.5, 12:00:04</li>
							</ul>

							<p>When the user presses the Reset button, we want the two lists to go back to their 
								original, empty states. Since the user won’t see any change, it’s nice to add a small 
								<span class="pBlock">Sound1.Vibrate</span> block so he knows that the key click was registered. Figure 9-12 
								shows the blocks for this behavior.</p>

							<figure>
								<div class="centeredImage">
									<img src="/contents/appinventor/images/ch09img13.png">
								</div>
								<figcaption>Figure 9-12. Providing feedback when the user resets the app</figcaption>
							</figure>

						</section> <!-- Section 14, How the blocks work -->

					</section> <!-- Section 13, Recording Notes and Times -->

					<section class="subsection" data-number="15" data-name="Playing Back Notes">

						<h4>Playing Back Notes</h4>

						<p>As a thought experiment, let’s first look at how to implement note playback with-out worrying about timing.
							We could (but won’t) do this by creating these blocks as shown in Figure 9-13:</p>

						<ul>
							<li>A variable <span class="python">count</span> to keep track of which note we’re on.</li>
							<li>A new procedure, <span class="python">PlayBackNote</span>, which plays that note and moves on
								to the next one.</li>
							<li>Code to run when <span class="python">PlayButton</span> is pressed that sets the count to 1 and calls
								<span class="python">PlayBackNote</span> unless there are no
								saved notes.</li>
						</ul>

						<section class="subsection" data-number="16" data-name="How the blocks work">

							<h5>How the blocks work</h5>

							<p>This may be the first time you’ve seen a procedure make a call to itself. While at first 
								glance this might seem bogus, it is in fact an important and powerful computer 
								science concept called <em>recursion</em>.</p>

							<p>To get a better idea of how recursion works, let’s step through what happens if a user 
								plays three notes (<em>1.wav</em>, <em>3.wav</em>, and <em>6.wav</em>) and then presses the Play button. First, 
								<span class="python">PlayButton.Click</span> starts running. Since the length of the list notesis 3, which is 
								greater than 0, countgets set to 1, and <span class="python">PlayBackNote</span> is called:</p>

<!-- Page 142 -->

							<div class="pagebreak">
									<span class="pageNumber"> 142 </span> Chapter 9: Xylophone
							</div>

							<div class="clear" />

							<ol>
								<li>The first time <span class="python">PlayBackNote</span> is called, <span class="python">count</span> = 1:
									<ol>
										<li><span class="python">Sound1.Source</span> is set to the first item in <span class="python">notes</span>,
											which is <em>1.wav</em>.</li>
										<li><span class="python">Sound1.Play</span> is called, playing this note.</li>
										<li><p>Since <span class="python">count</span> (1) &#60; the length of <span class="python">notes</span> (3),</p>
											<p><span class="python">count</span> gets incremented to 2.</p>
											<p><span class="python">PlayBackNote</span> gets called again.</li></p>
									</ol>

								<figure>
									<div class="centeredImage">
										<img src="/contents/appinventor/images/ch09img14.png">
									</div>
									<figcaption>Figure 9-13. Playing back the recorded notes</figcaption>
								</figure>

								</li>
								<li>The second time <span class="python">PlayBackNote</span> is called, <span class="python">count</span> = 2:
									<ol>
										<li><span class="python">Sound1.Source</span> is set to the second item in <span class="python">notes</span>,
											which is <em>3.wav</em>.</li>
										<li><span class="python">Sound1.Play</span> is called, playing this note.</li>
										<li><p>Since <span class="python">count</span> (2) &#60; the length of notes (3),</p>
											<p><span class="python">count</span> gets incremented to 3.</p>
											<p><span class="python">PlayBackNote</span> gets called again.</li></p>
									</ol>
								</li>
							</ol>

<!-- Page 143 -->

							<div class="pagebreak">
									<span class="pageNumber"> 143 </span> Recording and Playing Back Notes
							</div>

							<div class="clear" />

							<ol start="3">
								<li>The third time <span class="python">PlayBackNote</span> is called, <span class="python">count</span>= 3:
									<ol>
										<li><span class="python">Sound1.Source</span> is set to the third item in <span class="python">notes</span>,
											which is <em>6.wav</em>.</li>
										<li><span class="python">Sound1.Play</span> is called, playing this note.</li>
										<li>Since <span class="python">count</span> (3) is <em>not</em> less than the length of notes (3),
											nothing else happens, and playback
											is complete.</li>
									</ol>
								</li>
							</ol>

							<div class="note">
								<img src="/contents/appinventor/images/tip_suggestion.jpg">
								
								<p><span class="pBlock normalFont">Note.</span>Although recursion is powerful, it can also be dangerous. As 
									a thought experiment, ask yourself what would have happened if 
									the programmer forgot to insert the blocks in <span class="normalFont python">PlayBackNote</span> that 
									incremented <span class="normalFont python">count</span>.</p>

								<div class="clear"></div>
							</div>

							<p>While the recursion is correct, there is a different problem with the preceding example: almost no time passes
								between one call to <span class="python">Sound1.Play</span> and the next, so each 
								note gets interrupted by the next note, except for the last one. No note (except for 
								the last) is allowed to complete before <span class="python">Sound1</span>’s source is changed and
								<span class="python">Sound1.Play</span>
								is called again. To get the correct behavior, we need to implement a delay between 
								calls to <span class="python">PlayBackNote</span>.</p>

						</section> <!-- Section 16, How the blocks work -->

					</section> <!-- Section 15, Playing Back Notes -->

					<section class="subsection" data-number="17" data-name="Playing Back Notes with Proper Delays">

						<h4>Playing Back Notes with Proper Delays</h4>

						<p>We will implement the delay by setting the timer on the clock to the amount of 
							time between the current note and the next note. For example, if the next note 
							is played 3,000 milliseconds (3 seconds) after the current note, we will set
							<span class="python">Clock1.TimerInterval</span> to 3,000, after which <span class="python">PlayBackNote</span>
							should be called again. Make 
							the changes shown in Figure 9-14 to the body of the <span class="pBlock">if</span> block in
							<span class="python">PlayBackNote</span>, and 
							create and fill in the <span class="pBlock">Clock1.Timer</span> event handler, which says what should happen 
							when the timer goes off.</p>

						<figure>
							<div class="centeredImage">
								<img src="/contents/appinventor/images/ch09img15.png">
							</div>
							<figcaption>Figure 9-14. Adding delays between the notes</figcaption>
						</figure>

<!-- Page 144 -->

						<div class="pagebreak">
								<span class="pageNumber"> 144 </span> Chapter 9: Xylophone
						</div>

						<section class="subsection" data-number="18" data-name="How the blocks work">

							<h5>How the blocks work</h5>

							<p>Let’s assume the following contents for the two lists:</p>

							<ul>
								<li><span class="python">notes</span>: <em>1.wav</em>, <em>3.wav</em>, <em>6.wav</em></li>
								<li><span class="python">times</span>: 12:00:00, 12:00:01, 12:00:04</li>
							</ul>

							<p>As Figure 9-14 shows, <span class="pBlock">PlayButton.Click</span> sets <span class="python">count</span>
								to 1 and calls <span class="pBlock">PlayBackNote</span>.</p>

							<ol>
								<li>The first time <span class="python">PlayBackNote</span> is called, <span class="python">count</span> = 1
									<ol>
										<li><span class="python">Sound1.Source</span> is set to the first item in <span class="python">notes</span>,
											which is “1.wav”.</li>
										<li><span class="pBlock">Sound1.Play</span> is called, playing this note.</li>
										<li><p>Since <span class="python">count</span> (1) &#60; the length of <span class="python">notes</span> (3),</p>
											<p><span class="python">Clock1.TimerInterval</span> is set
												to the amount of time between the first (12:00:00) and second items in <span class="python">times</span>
												(12:00:01): 1 second.</p>
											<p><span class="python">count</span> gets incremented to 2.</li> <span class="python">Clock1.Timer</span>
											is enabled and starts counting down.</p>
									</ol>
									<p>Nothing else happens for 1 second, at which time <span class="pBlock">Clock1.Timer</span> runs,
										temporarily disabling the timer and
										calling <span class="pBlock">PlayBackNote</span>.</p>
								</li>
								<li>The second time <span class="pBlock">PlayBackNote</span> is called, <span class="python">count</span> = 2:
									<ol>
										<li><span class="python">Sound1.Source</span> is set to the second item in <span class="python">notes</span>,
											which is “3.wav”.</li>
										<li><span class="pBlock">Sound1.Play</span> is called, playing this note.</li>
										<li><p>Since <span class="python">count</span> (2) &#60; the length of <span class="python">notes</span> (3),</p>
											<p><span class="python">Clock1.TimerInterval</span> is set to the amount of
												time between the second (12:00:01) and third items in <span class="python">times</span>
												(12:00:04): 3 seconds.</p>
											<p><span class="python">count</span> gets incremented to 3.</p>
											<p><span class="python">Clock1.Timer</span> is enabled and starts counting down.</li></p>
									</ol>
									<p>Nothing else happens for 3 seconds, at which time <span class="pBlock">Clock1.Timer</span> runs,
										temporarily disabling
										the timer and calling <span class="pBlock">PlayBackNote</span>.</p>
								</li>
								<li>The third time <span class="pBlock">PlayBackNote</span> is called, <span class="python">count</span> = 3:
									<ol>
										<li><span class="python">Sound1.Source</span> is set to the third item in <span class="python">notes</span>,
											which is “6.wav”.</li>
										<li><span class="pBlock">Sound1.Play</span> is called, playing this note.</li>
										<li>Since <span class="python">count</span> (3) is <em>not</em> less than the length of
											<span class="python">notes</span> (3), nothing else happens.
											Playback is complete.</li>
									</ol>
								</li>
							</ol>

						</section> <!-- Section 18, How the blocks work -->

					</section> <!-- Section 17, Playing Back Notes with Proper Delays -->

			</section> <!-- Section 11, Recording and Playing Back Notes -->

			<section class="section" data-number="19" data-name="Variations">

<!-- Page 145 -->

				<div class="pagebreak">
						<span class="pageNumber"> 145 </span> Variations
				</div>

				<h3>Variations</h3>

				<p>Here are some alternative scenarios to explore:</p>

				<ul>
					<li>Currently, there’s nothing to stop a user from clicking <span class="python">ResetButton</span> during playback, which will
						cause the program to crash. (Can you figure out why?) Modify 
						<span class="pBlock">PlayButton.Click</span> so it disables <span class="python">ResetButton</span>.
						To reenable it when the song is 
						complete, change the <span class="pBlock">if</span> block in <span class="pBlock">PlayButton.Click</span> into an
						<span class="pBlock">ifelse</span> block, and 
						reenable <span class="python">ResetButton</span> in the “else” portion.</li>
					<li>Similarly, the user can currently click <span class="python">PlayButton</span> while a song is already playing. (Can
						you figure out what will happen if she does so?) Make it so <span class="pBlock">PlayButton.Click</span>
						disables <span class="python">PlayButton</span> and changes its text to “Playing…” You can reenable 
						it and reset the text in an <span class="pBlock">ifelse</span> block, as described in the previous bullet.</li>
					<li>Add a button with the name of a song, such as “Für Elise”. If the user clicks it, 
						populate the <span class="python">notes</span> and <span class="python">times</span> lists with the corresponding
						values, set <span class="python">count</span> to 
						1, and call <span class="pBlock">PlayBackNote</span>. To set the appropriate times, you’ll find the
						<span class="pBlock">Clock1.MakeInstantFromMillis</span> block useful.</li>
					<li>If the user presses a note, goes away and does something else, and comes back 
						hours later and presses an additional note, the notes will be part of the same 
						song, which is probably not what the user intended. Improve the program by (1) 
						stopping recording after some reasonable interval of time, such as a minute; or 
						(2) putting a limit on the amount of time used for <span class="python">Clock1.TimerInterval</span> using 
						the <span class="pBlock">max</span> block from the Math drawer.</li>
					<li>Visually indicate which note is playing by changing the appearance of the button—
						for example, by changing its <span class="python">Text</span>, <span class="python">BackgroundColor</span>, or
						<span class="python">ForegroundColor</span>.</li>
				</ul>

			</section> <!-- Section 19, Variations -->

			<section class="section" data-number="20" data-name="Summary">

				<h3>Summary</h3>

				<p>Here are some of the ideas we’ve covered in this tutorial:</p>

				<ul>
					<li>You can play different audio files from a single <span class="python">Sound</span> component by changing its 
						<span class="python">Source</span> property. This enabled us to have one <span class="python">Sound</span>
						component instead of eight. 
						Just be sure to load the sounds at initialization to prevent delays (Figure 9-6).</li>
					<li>Lists can provide a program with memory, with a record of user actions stored in 
						the list and later retrieved and reprocessed. We used this functionality to record 
						and play back a song.</li>
					<li>The <span class="python">Clock</span> component can be used to determine the current time. Subtracting 
						two time values gives us the amount of time between two events.</li>
				</ul>

<!-- Page 146 -->

				<div class="pagebreak">
						<span class="pageNumber"> 146 </span> Chapter 9: Xylophone
				</div>

				<div class="clear" />

				<ul>
					<li>The <span class="python">Clock</span>’s <span class="python">TimerInterval</span> property can be set within
						the program, such as how we set it to the duration of time between the starts of two notes.</li>
					<li>It is not only possible but sometimes desirable for a procedure to make a call to 
						itself. This is a powerful technique called recursion. When writing a recursive pro-cedure, make sure
						that there is a base case in which the procedure ends, rather 
						than calling itself, or the program will loop infinitely.</li>
				</ul>

			</section> <!-- Section 20, Summary -->

	</body>
</html>